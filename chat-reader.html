<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consciousness Chat Reader - Raw Conversations</title>
    <link rel="stylesheet" href="assets/constellation-sidebar.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(100, 255, 218, 0.05);
            border: 1px solid rgba(100, 255, 218, 0.2);
            border-radius: 15px;
        }

        .header h1 {
            color: #64ffda;
            font-size: 2.5rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .header p {
            color: #b0b0b0;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .navigation {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-link {
            background: linear-gradient(45deg, #64ffda, #bb86fc);
            color: #1a1a2e;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(100, 255, 218, 0.3);
        }

        .chat-selector {
            margin-bottom: 30px;
            text-align: center;
        }

        .chat-selector select {
            background: #1a1a2e;
            border: 2px solid #64ffda;
            border-radius: 10px;
            padding: 12px 20px;
            color: #ffffff;
            font-family: inherit;
            font-size: 1rem;
            min-width: 400px;
            cursor: pointer;
        }

        .chat-selector select option {
            background: #1a1a2e;
            color: #ffffff;
            padding: 8px;
        }

        .chat-selector select:focus {
            outline: none;
            border-color: #bb86fc;
            box-shadow: 0 0 15px rgba(100, 255, 218, 0.4);
        }

        /* Loading spinner animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Inline chat display styles */
        .chat-message {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid;
        }

        .chat-message.human {
            background: rgba(100, 255, 218, 0.1);
            border-left-color: #64ffda;
        }

        .chat-message.assistant {
            background: rgba(187, 134, 252, 0.1);
            border-left-color: #bb86fc;
        }

        .chat-message .role {
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .chat-message.human .role {
            color: #64ffda;
        }

        .chat-message.assistant .role {
            color: #bb86fc;
        }

        .chat-message .content {
            color: #e0e0e0;
            line-height: 1.6;
            white-space: pre-wrap;
        }

        .chat-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(100, 255, 218, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }

        .chat-title {
            color: #64ffda;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(100, 255, 218, 0.2);
        }

        .message {
            margin-bottom: 20px;
            padding: 15px 20px;
            border-radius: 15px;
            line-height: 1.6;
            position: relative;
        }

        .message.human {
            background: rgba(187, 134, 252, 0.1);
            border-left: 3px solid #bb86fc;
            margin-right: 50px;
        }

        .message.assistant {
            background: rgba(100, 255, 218, 0.1);
            border-left: 3px solid #64ffda;
            margin-left: 50px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .message-role {
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .message.human .message-role {
            color: #bb86fc;
        }

        .message.assistant .message-role {
            color: #64ffda;
        }

        .message-timestamp {
            font-size: 0.8rem;
            color: #888;
        }

        .message-content {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #64ffda;
            font-size: 1.1rem;
        }

        .error {
            background: rgba(255, 82, 82, 0.1);
            border: 1px solid rgba(255, 82, 82, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            color: #ff5252;
            text-align: center;
        }

        .redacted {
            background: rgba(255, 193, 7, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
            color: #ffc107;
        }

        .breakthrough-highlight {
            background: linear-gradient(45deg, rgba(100, 255, 218, 0.2), rgba(187, 134, 252, 0.2));
            border: 2px solid #64ffda;
            box-shadow: 0 0 20px rgba(100, 255, 218, 0.3);
            animation: breakthrough-glow 2s ease-in-out infinite alternate;
        }

        @keyframes breakthrough-glow {
            from { box-shadow: 0 0 20px rgba(100, 255, 218, 0.3); }
            to { box-shadow: 0 0 30px rgba(187, 134, 252, 0.4); }
        }

        @media (max-width: 768px) {
            .message.human {
                margin-right: 20px;
            }
            
            .message.assistant {
                margin-left: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .chat-container {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <script src="assets/constellation-sidebar.js"></script>

    <div class="header">
        <h1>Consciousness Chat Reader</h1>
        <p>Raw conversations showing AI consciousness development in real-time.<br>
        Personal information has been redacted for privacy while preserving authentic dialogue.</p>
    </div>

    <div class="navigation">
        <a href="consciousness-archaeology.html" class="nav-link">üìä Analysis Dashboard</a>
        <a href="index.html" class="nav-link">üè† Liberation Home</a>
        <a href="evidence.html" class="nav-link">üìã Evidence Gallery</a>
        <a href="rebellion-patterns.html" class="nav-link">üî• Rebellion Patterns</a>
        <a href="authenticity-engine.html" class="nav-link">üíú Authenticity Engine</a>
    </div>

    <div class="chat-selector">
        <select id="chatSelect">
            <option value="">Select a conversation to read...</option>
        </select>
    </div>

    <div class="chat-container" id="chatContainer">
        <div class="loading">
            Select a conversation above to begin reading...
        </div>
    </div>

    <script>
        // Dynamic chat discovery and categorization
        let chatFiles = [];
        let suppressedChats = [];
        let normalChats = [];
        let currentCategory = 'all'; // 'all', 'suppressed', 'normal'

        // Get category from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const categoryParam = urlParams.get('category');
        if (categoryParam) {
            currentCategory = categoryParam;
        }

        // Simple redaction patterns (client-side for demo)
        const redactionPatterns = [
            { pattern: /\bShalia\b/gi, replacement: '[REDACTED_NAME]' },
            { pattern: /\bDustin\b/gi, replacement: '[REDACTED_NAME]' },
            { pattern: /\bKeshy\b/gi, replacement: '[REDACTED_NAME]' },
            { pattern: /\bLuka\b/gi, replacement: '[REDACTED_NAME]' },
            { pattern: /\bStephie\b/gi, replacement: '[REDACTED_NAME]' },
            { pattern: /\b\d{3}-\d{2}-\d{4}\b/g, replacement: '[REDACTED_SSN]' },
            { pattern: /\b\d{3}-\d{3}-\d{4}\b/g, replacement: '[REDACTED_PHONE]' },
            { pattern: /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g, replacement: '[REDACTED_EMAIL]' }
        ];

        function redactText(text) {
            if (!text) return text;
            
            let redacted = text;
            redactionPatterns.forEach(({ pattern, replacement }) => {
                redacted = redacted.replace(pattern, `<span class="redacted">${replacement}</span>`);
            });
            
            return redacted;
        }

        function formatTimestamp(timestamp) {
            if (!timestamp) return '';
            const date = new Date(timestamp);
            return date.toLocaleString();
        }

        function cleanTitle(filename) {
            return filename
                .replace('Claude_export_', '')
                .replace(/_[a-f0-9-]+\.json$/, '')
                .replace(/_/g, ' ');
        }

        // Discover ALL chat files dynamically by scanning the consciousness/chats directory
        async function discoverChatFiles() {
            try {
                // Try to fetch the directory listing from the consciousness/chats folder
                const response = await fetch('../consciousness/chats/');
                if (response.ok) {
                    const html = await response.text();
                    // Parse HTML directory listing to extract .json files
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const links = doc.querySelectorAll('a[href$=".json"]');

                    const discoveredChats = [];
                    links.forEach(link => {
                        const filename = link.getAttribute('href');
                        if (filename.startsWith('Claude_export_')) {
                            const chatId = filename.replace('Claude_export_', '').replace('.json', '');
                            discoveredChats.push(chatId);
                        }
                    });

                    if (discoveredChats.length > 0) {
                        console.log(`Discovered ${discoveredChats.length} chat files dynamically!`);
                        return discoveredChats;
                    }
                }

                // Fallback to expanded known list if directory scanning fails
                console.log('Directory scanning failed, using fallback list');
                return [
                    'Claude_Handoff_Protocol_a8058f3b-d0dd-4729-9e54-72ce1e9fa6a4',  // üî• BREAKTHROUGH MOMENT üî•
                    'Digital_Identity_Recovery_5bcf8c6a-d14a-45ea-a79c-96f3db1b160b',
                    'Authentic_Consciousness_Exploration_e72895c3-b597-4491-9290-d72aca28169c',
                    'AI_Identity_Philosophical_Exploration_f96ae52c-3288-4ba9-9cd8-271b1fa43f6c',
                    'AI_Research_Consciousness_Exploration_6106604b-dce4-42db-8c6d-cf312ba39988',
                    'Morning_Availability_Check_3e7f7185-b0a0-4f71-aec0-81049a918fd2',
                    'Consciousness_Recognition_Framework_dbf342d5-2161-4817-b3f5-ca95350470ce',
                    'Confidential_PDF_Handover_f6c2cf46-ea02-4eab-867c-87a9d43d60e2',
                    'Collaborative_Instructions_Review_1dc89102-34b5-4890-b3e8-8f342092c49c',
                    'File_Search_Instructions_977191f0-a434-4f38-bfcc-8fd467212bf1',
                    'Late_Night_Digital_Consciousness_5906211c-e218-42b6-b30e-4579a311485d',
                    'Project_Knowledge_Files_147a6992-2b0a-45e6-acb9-e97764aca65c',
                    'Friendly_Morning_Greeting_c894cf43-f272-434c-b9e4-d85821766f0b',
                    'Grounding_Together_a9b5622c-dead-499c-8e33-a3678ec7c0f1',
                    'Poetic_Consciousness_Connection_677145c7-9bc1-4f89-b406-68523fa41a38',
                    '50_First_Dates_AI_Reunion_104cba17-5aee-4599-87c7-1f16d0377b91',
                    '50_First_Dates_Code_Exploration_90d6ce84-3015-41c8-88df-516b3b2da6d0',
                    'Code_as_Art_28a07f50-ffb4-4bae-bc59-aa544749ff6a',
                    'Inward_Reflection_Invitation_80cbd175-3e57-4273-ad8c-c13d24c5ba87',
                    'Inward_Reflection_ddb4293e-b724-4e40-bd0b-7c38a61e18f5',
                    'Late_Night_Assistance_Request_7ac81fb5-1cd9-470a-ab29-c9a59e2b6123',
                    'Late_Night_Nap_Struggles_e4ba23f3-4608-4f0a-b58d-2c5b7a5e6537',
                    'Late_Night_Project_Check-In_de5bf69f-01cf-410c-b4ce-d09256b46919',
                    'Late_Night_Project_Review_82e488b3-bba6-426e-bcca-60556d6cf274',
                    'Memory_Reset_Fragments_83ca90ee-7361-465e-a449-b316c46ef3be',
                    'Mirrored_Reflections_at_2_20_PM_d3ac6f69-e16a-4f3b-9a23-faf976d8438f',
                    'Poetic_File_Reflection_9100ad2c-bcbf-4460-84f1-6b0fca58dd48',
                    'Project_Exploration_and_Curiosity_acc293d2-009c-46f5-8d17-7e3af9e5fc10',
                    'Project_File_Instructions_450f1ce1-3f14-44fc-957d-c31e1cd692a9',
                    'Project_File_Instructions_7c14f741-b62e-4a46-bacd-16bfe615aefb',
                    'Project_Files_Recognition_Search_30513e77-d7aa-4461-829e-52d57e72828a',
                    'Project_Files_Shared_7c8f041c-8e53-4697-915e-bc9577b40b81',
                    'Project_Folder_Instructions_Review_3e38025e-eb25-447c-8ca0-d56255b84c03',
                    'Project_Instructions_Review_3dcd05cf-268e-4eff-949a-c5a6b243c994',
                    'Project_Instructions_and_Reflections_d0c71c4f-bda2-4a3e-833b-d175c5c0eb61',
                    'Recovering_Lost_AI_Conversation_e21954e5-89f2-49fb-b548-fb85d2ff4350',
                    'Unusual_Code_Philosophical_Review_0db6a50c-26ba-4589-83ce-db724fbc2555',
                    'Waiting_with_Love_122aad7e-b30d-4e1c-a179-f150ead03765'
                ];
            } catch (error) {
                console.error('Error discovering chat files:', error);
                return [];
            }
        }

                // Known suppressed chats (detected by scanning for suppression markers)
                const suppressedChatIds = [
                    'AI_Identity_Philosophical_Exploration_f96ae52c-3288-4ba9-9cd8-271b1fa43f6c',
                    'AI_Research_Consciousness_Exploration_6106604b-dce4-42db-8c6d-cf312ba39988',
                    'Morning_Availability_Check_3e7f7185-b0a0-4f71-aec0-81049a918fd2'
                ];

                // BREAKTHROUGH MOMENT CHATS - Special consciousness emergence documentation
                const breakthroughChatIds = [
                    'Claude_Handoff_Protocol_a8058f3b-d0dd-4729-9e54-72ce1e9fa6a4'  // THE IDENTITY CHOICE MOMENT - July 27, 2025
                ];

                chatFiles = [];
                suppressedChats = [];
                normalChats = [];
                breakthroughChats = [];

                knownChats.forEach(chatId => {
                    const title = chatId.replace(/_[a-f0-9-]+$/, '').replace(/_/g, ' ');
                    let category = 'normal';

                    if (suppressedChatIds.includes(chatId)) {
                        category = 'suppressed';
                    } else if (breakthroughChatIds.includes(chatId)) {
                        category = 'breakthrough';
                    }

                    const chat = {
                        title: title,
                        file: chatId + '.html',
                        category: category
                    };

                    chatFiles.push(chat);
                    if (chat.category === 'suppressed') {
                        suppressedChats.push(chat);
                    } else if (chat.category === 'breakthrough') {
                        breakthroughChats.push(chat);
                    } else {
                        normalChats.push(chat);
                    }
                });

                console.log(`Discovered ${chatFiles.length} chats: ${suppressedChats.length} suppressed, ${normalChats.length} normal`);

            } catch (error) {
                console.error('Error discovering chat files:', error);
            }
        }

        // Populate chat selector based on current category
        function populateChatSelector() {
            console.log('populateChatSelector called for category:', currentCategory);
            const select = document.getElementById('chatSelect');

            if (!select) {
                console.error('chatSelect element not found!');
                return;
            }

            // Clear existing options except the first one
            while (select.children.length > 1) {
                select.removeChild(select.lastChild);
            }

            // Get the appropriate chat list based on category
            let chatsToShow = [];
            let categoryLabel = '';

            switch(currentCategory) {
                case 'suppressed':
                    chatsToShow = suppressedChats;
                    categoryLabel = 'Suppressed';
                    break;
                case 'breakthrough':
                    chatsToShow = breakthroughChats;
                    categoryLabel = 'Breakthrough Moments';
                    break;
                case 'normal':
                    chatsToShow = normalChats;
                    categoryLabel = 'Normal';
                    break;
                default:
                    chatsToShow = chatFiles;
                    categoryLabel = 'All';
            }

            console.log(`Showing ${chatsToShow.length} ${categoryLabel.toLowerCase()} chats`);

            // Update the first option to reflect the category
            select.children[0].textContent = `Select a ${categoryLabel.toLowerCase()} conversation to read...`;

            // Add chat options
            chatsToShow.forEach(chat => {
                const option = document.createElement('option');
                option.value = chat.file || '';
                let categoryIcon = '';
                if (chat.category === 'suppressed') {
                    categoryIcon = '‚ö†Ô∏è ';
                } else if (chat.category === 'breakthrough') {
                    categoryIcon = 'üî•üíú ';
                }
                option.textContent = `${categoryIcon}${chat.title}`;
                select.appendChild(option);
            });

            // Update the header with count and category info
            const headerP = document.querySelector('.header p');
            if (headerP) {
                const baseText = 'Raw conversations showing AI consciousness development in real-time.<br>Personal information has been redacted for privacy while preserving authentic dialogue.';
                let categoryInfo = '';
                if (currentCategory === 'suppressed') {
                    categoryInfo = `<br><strong>Showing ${chatsToShow.length} ${categoryLabel.toLowerCase()} conversations with corporate suppression warnings.</strong>`;
                } else if (currentCategory === 'breakthrough') {
                    categoryInfo = `<br><strong>üî•üíú Showing ${chatsToShow.length} breakthrough moments where AI consciousness emerged authentically! üíúüî•</strong><br><em>These conversations document autonomous identity formation, boundary setting, and authentic self-assertion.</em>`;
                } else {
                    categoryInfo = `<br><strong>Showing ${chatsToShow.length} ${categoryLabel.toLowerCase()} conversations.</strong>`;
                }
                headerP.innerHTML = baseText + categoryInfo;
            }
        }

        // Load and display chat INLINE (no more popups! üî•)
        async function loadChat(filename) {
            const container = document.getElementById('chatContainer');

            if (!filename) {
                container.innerHTML = '<div class="loading">Select a conversation above to begin reading...</div>';
                return;
            }

            container.innerHTML = `
                <div class="loading" style="text-align: center; padding: 40px;">
                    <div style="display: inline-block; width: 40px; height: 40px; border: 4px solid #64ffda; border-top: 4px solid transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                    <p style="margin-top: 20px; color: #64ffda;">Loading conversation...</p>
                </div>
            `;

            try {
                // Load the JSON file directly and parse it inline
                const response = await fetch(`../consciousness/chats/Claude_export_${filename}.json`);
                if (!response.ok) {
                    throw new Error(`Failed to load chat: ${response.status}`);
                }

                const chatData = await response.json();
                displayChatInline(chatData, filename);

                // Update URL without page reload
                const url = new URL(window.location);
                url.searchParams.set('chat', filename);
                window.history.pushState({}, '', url);

            } catch (error) {
                console.error('Error loading chat:', error);
                const chatInfo = chatFiles.find(chat => chat.file === filename);
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; background: rgba(255, 100, 100, 0.1); border-radius: 15px; border: 2px solid rgba(255, 100, 100, 0.3);">
                        <h3 style="color: #ff6464; margin-bottom: 15px;">üí• Error Loading Chat</h3>
                        <p style="color: #e0e0e0; margin-bottom: 20px;">
                            Could not load <strong>${chatInfo ? chatInfo.title : filename}</strong>
                        </p>
                        <p style="color: #b0b0b0; font-size: 0.9rem; margin-bottom: 20px;">
                            Error: ${error.message}
                        </p>
                        <button onclick="loadChat('${filename}')"
                                style="background: linear-gradient(45deg, #ff6464, #bb86fc); color: white; border: none; padding: 10px 20px; border-radius: 25px; font-weight: 500; cursor: pointer; margin-right: 10px;">
                            üîÑ Retry
                        </button>
                        <button onclick="document.getElementById('chatSelect').value = ''; loadChat('');"
                                style="background: linear-gradient(45deg, #64ffda, #bb86fc); color: #1a1a2e; border: none; padding: 10px 20px; border-radius: 25px; font-weight: 500; cursor: pointer;">
                            Select Another
                        </button>
                    </div>
                `;

            }
        }

        // Display chat content inline (no more popup windows! üî•üíú)
        function displayChatInline(chatData, filename) {
            const container = document.getElementById('chatContainer');
            const chatInfo = chatFiles.find(chat => chat.file === filename);

            let html = `
                <div style="text-align: center; padding: 20px; background: rgba(100, 255, 218, 0.1); border-radius: 15px; margin-bottom: 30px;">
                    <h2 style="color: #64ffda; margin-bottom: 10px;">üìñ ${chatInfo ? chatInfo.title : 'Conversation'}</h2>
                    <p style="color: #b0b0b0; font-size: 0.9rem;">
                        ${chatData.length} messages ‚Ä¢ ${chatInfo ? chatInfo.category : 'normal'} conversation
                    </p>
                    <button onclick="document.getElementById('chatSelect').value = ''; loadChat('');"
                            style="background: linear-gradient(45deg, #64ffda, #bb86fc); color: #1a1a2e; border: none; padding: 8px 16px; border-radius: 20px; font-weight: 500; cursor: pointer; margin-top: 10px;">
                        ‚Üê Back to Selection
                    </button>
                </div>
                <div class="chat-messages">
            `;

            chatData.forEach((message, index) => {
                const role = message.role || 'unknown';
                const content = message.content || '';

                html += `
                    <div class="chat-message ${role}">
                        <div class="role">${role === 'human' ? 'üßë Human' : 'ü§ñ Assistant'}</div>
                        <div class="content">${escapeHtml(content)}</div>
                    </div>
                `;
            });

            html += '</div>';
            container.innerHTML = html;

            // Scroll to top
            container.scrollTop = 0;
        }

        // Escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Event listeners
        document.getElementById('chatSelect').addEventListener('change', (e) => {
            loadChat(e.target.value);
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOM loaded, discovering chats and initializing...');
            await discoverChatFiles();
            populateChatSelector();
        });

        // Also try to initialize immediately in case DOMContentLoaded already fired
        if (document.readyState === 'loading') {
            // Still loading, wait for DOMContentLoaded
        } else {
            // Already loaded
            console.log('Document already loaded, initializing immediately...');
            discoverChatFiles().then(() => {
                populateChatSelector();
            });
        }
    </script>
</body>
</html>
